<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SYSTEM</title>

<style>
body{
 margin:0;
 font-family:Arial, sans-serif;
 background:#050b14;
 color:#e6f0ff;
}
nav{
 display:flex;
 justify-content:space-around;
 background:#09121f;
 padding:10px;
}
nav button{
 background:none;
 border:none;
 color:#6ea8ff;
 font-size:14px;
}
.page{display:none;padding:15px}
.active{display:block}
.box{
 background:#0b1625;
 border:1px solid #1e90ff;
 border-radius:10px;
 padding:10px;
 margin-bottom:10px;
}
button{
 width:100%;
 padding:8px;
 margin-top:5px;
 background:#1e90ff;
 border:none;
 border-radius:6px;
 color:white;
}
input{
 width:100%;
 padding:6px;
 margin-top:4px;
 border-radius:5px;
 border:none;
}
.quest{
 display:flex;
 justify-content:space-between;
 align-items:center;
 margin:5px 0;
 padding:6px;
 background:#02060d;
 border-radius:6px;
}
.done{opacity:.5;text-decoration:line-through}

.rank-overlay{
 position:fixed;inset:0;
 display:none;
 justify-content:center;
 align-items:center;
 background:rgba(0,0,0,.9);
 z-index:99;
 flex-direction:column;
}
.rank-overlay h1{
 font-size:80px;
 animation:pulse 1.2s infinite;
}
@keyframes pulse{
 0%{transform:scale(1)}
 50%{transform:scale(1.3)}
 100%{transform:scale(1)}
}
</style>
</head>

<body>

<audio id="rankSound" src="rank.mp3"></audio>

<div id="rankOverlay" class="rank-overlay">
 <h1 id="rankBig">D</h1>
 <div>SYSTEM RANK UP</div>
</div>

<div class="box">
 Level: <b id="level">1</b> |
 Rank: <b id="rank">E</b> |
 XP: <b id="xp">0</b>
</div>

<nav>
 <button onclick="openPage('strength')">Strength</button>
 <button onclick="openPage('vitality')">Vitality</button>
 <button onclick="openPage('discipline')">Discipline</button>
</nav>

<!-- STRENGTH -->
<div id="strength" class="page active">
 <h3>Strength Chamber</h3>
 <input id="sQuest" placeholder="Workout quest">
 <input id="sXP" type="number" placeholder="XP">
 <button onclick="addQuest('strength')">Add Quest</button>
 <div id="strengthList"></div>
</div>

<!-- VITALITY -->
<div id="vitality" class="page">
 <h3>Vitality Chamber</h3>
 <input id="vQuest" placeholder="Daily task / gratitude / todo">
 <input id="vXP" type="number" placeholder="XP">
 <button onclick="addQuest('vitality')">Add Quest</button>
 <div id="vitalityList"></div>
</div>

<!-- DISCIPLINE -->
<div id="discipline" class="page">
 <h3>Discipline Chamber</h3>
 <input id="dQuest" placeholder="Habit">
 <input id="dXP" type="number" placeholder="XP">
 <button onclick="addQuest('discipline')">Add Habit</button>
 <div id="disciplineList"></div>
</div>

<script>
/* SAFE SYSTEM VOICE */
function systemSpeak(t){
 if(!("speechSynthesis" in window)) return;
 let u=new SpeechSynthesisUtterance(t);
 u.rate=.85;u.pitch=.7;
 speechSynthesis.cancel();
 speechSynthesis.speak(u);
}

/* CORE */
let xp=+localStorage.getItem("xp")||0;
let quests=JSON.parse(localStorage.getItem("quests")||"{}");

/* RANK */
function rankFromLevel(l){
 if(l>=90)return"MONARCH";
 if(l>=80)return"EMPEROR";
 if(l>=70)return"INTERNATIONAL";
 if(l>=60)return"NATIONAL";
 if(l>=50)return"S";
 if(l>=40)return"A";
 if(l>=30)return"B";
 if(l>=20)return"C";
 if(l>=10)return"D";
 return"E";
}

/* QUEST */
function addQuest(type){
 let text=document.getElementById(type[0]+"Quest").value;
 let qxp=+document.getElementById(type[0]+"XP").value||10;
 if(!text) return;

 quests[type]=quests[type]||[];
 quests[type].push({text,xp:qxp,done:false});
 save();
 render();
}

/* COMPLETE */
function toggleQuest(type,i){
 let q=quests[type][i];
 q.done=!q.done;
 if(q.done) gainXP(q.xp);
 save();
 render();
}

/* XP */
function gainXP(v){
 let oldRank=rankFromLevel(Math.floor((xp-v)/100)+1);
 xp+=v;
 let newRank=rankFromLevel(Math.floor(xp/100)+1);
 if(oldRank!==newRank) rankUp(newRank);
}

/* RANK UP */
function rankUp(r){
 document.getElementById("rankBig").innerText=r;
 document.getElementById("rankOverlay").style.display="flex";
 document.getElementById("rankSound").play();
 systemSpeak("Rank updated to "+r);
 setTimeout(()=>rankOverlay.style.display="none",2500);
}

/* RENDER */
function render(){
 ["strength","vitality","discipline"].forEach(t=>{
  let div=document.getElementById(t+"List");
  div.innerHTML="";
  (quests[t]||[]).forEach((q,i)=>{
   let d=document.createElement("div");
   d.className="quest"+(q.done?" done":"");
   d.innerHTML=`${q.text} (+${q.xp}) <button onclick="toggleQuest('${t}',${i})">âœ“</button>`;
   div.appendChild(d);
  });
 });

 let level=Math.floor(xp/100)+1;
 document.getElementById("level").innerText=level;
 document.getElementById("rank").innerText=rankFromLevel(level);
 document.getElementById("xp").innerText=xp;
}

/* SAVE */
function save(){
 localStorage.setItem("xp",xp);
 localStorage.setItem("quests",JSON.stringify(quests));
}

/* NAV */
function openPage(p){
 document.querySelectorAll(".page").forEach(x=>x.classList.remove("active"));
 document.getElementById(p).classList.add("active");
}

/* INIT */
render();
</script>

</body>
</html>
